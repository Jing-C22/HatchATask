<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hatch-a-task - Your Personal Task Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
  /* Enhanced Hatch-a-task App Styles */

  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }

  :root {
      --primary-color: #87A96B;
      --primary-light: #A5C085;
      --primary-dark: #6B8F47;
      --accent-color: #F4C2A1;
      --accent-pink: #D4B5A0;
      --accent-heart: #E8B4B4;
      --background: #F9F7F4;
      --card-bg: #FFFFFF;
      --grid-color: #E8E4E0;
      --text-primary: #4A4A4A;
      --text-secondary: #7A7A7A;
      --border-color: #E8E4E0;
      --success-color: #87A96B;
      --warning-color: #E8A87C;
      --danger-color: #D69E2E;
      --coin-color: #F6D55C;
  }

  /* Time-of-day themes */
  .theme-morning {
      background: linear-gradient(135deg, #FDF9F3 0%, #F0F5E8 100%);
  }

  .theme-afternoon {
      background: linear-gradient(135deg, #F9F7F4 0%, #F2F0E8 100%);
  }

  .theme-night {
      background: linear-gradient(135deg, #1A1F1A 0%, #2D3A2D 100%);
      color: #E8F0E8;
  }

  .theme-night .navbar,
  .theme-night .pet-section,
  .theme-night .tasks-section,
  .theme-night .stat-card,
  .theme-night .stat-overview-card,
  .theme-night .chart-card,
  .theme-night .calendar-container,
  .theme-night .accessory-card,
  .theme-night .badge-card,
  .theme-night .modal-content {
      background: #2A3B2A;
      border-color: #4A5D4A;
  }

  .theme-night .bar { background: linear-gradient(180deg, #A5C085, #6B8F47); }
  .theme-night .card-icon { background: #4A5D4A; }
  .theme-night .task-item { background: #334233; }

  body {
      font-family: 'Inter', 'Space Grotesk', sans-serif;
      background: linear-gradient(135deg, #FDF9F3 0%, #F0F5E8 100%);
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
  }

  body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
          repeating-linear-gradient(0deg, transparent, transparent 39px, var(--grid-color) 39px, var(--grid-color) 40px),
          repeating-linear-gradient(90deg, transparent, transparent 39px, var(--grid-color) 39px, var(--grid-color) 40px);
      opacity: 0.3;
      pointer-events: none;
      z-index: 0;
  }

  /* Page transitions */
  .page {
      display: none;
      animation: fadeIn 0.5s ease-in-out;
      position: relative;
      z-index: 1;
  }

  .page.active {
      display: block;
  }

  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
  }

  /* Login Page Styles */
  .login-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 2rem;
  }

  .login-content {
      text-align: center;
      margin-bottom: 4rem;
      animation: slideDown 0.8s ease-out;
  }

  @keyframes slideDown {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
  }

  .logo {
      margin-bottom: 2rem;
  }

  .logo i {
      font-size: 4rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: block;
      filter: drop-shadow(0 4px 6px rgba(153, 153, 255, 0.3));
  }

  .logo h1 {
      font-size: 3rem;
      font-weight: 700;
      font-family: 'Space Grotesk', sans-serif;
      color: var(--primary-color);
      text-shadow: 2px 2px 4px rgba(153, 153, 255, 0.2);
  }

  .subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 3rem;
  }

  /* Auth Tabs */
  .auth-tabs {
      display: flex;
      background: var(--card-bg);
      border-radius: 15px;
      padding: 0.5rem;
      margin-bottom: 2rem;
      border: 2px solid var(--primary-light);
  }

  .tab-btn {
      flex: 1;
      background: transparent;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      color: var(--text-secondary);
  }

  .tab-btn.active {
      background: var(--primary-color);
      color: white;
  }

  .tab-btn:hover:not(.active) {
      color: var(--primary-color);
  }

  /* Auth Forms */
  .auth-form {
      display: none;
      background: var(--background);
      padding: 2.5rem;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(153, 153, 255, 0.1);
      max-width: 500px;
      margin: 0 auto;
      border: 3px solid var(--primary-light);
  }

  .auth-form.active {
      display: block;
  }

  .auth-form h2 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--primary-color);
  }

  .input-group {
      display: flex;
      gap: 1rem;
      flex-direction: column;
      margin-bottom: 1.5rem;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="date"],
  input[type="datetime-local"],
  select,
  textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--background);
      border: 2px solid var(--primary-light);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 1rem;
      transition: all 0.3s;
      font-family: 'Inter', sans-serif;
  }

  textarea {
      resize: vertical;
      min-height: 80px;
  }

  input:focus,
  select:focus,
  textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(153, 153, 255, 0.1);
  }

  .btn-primary {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 4px 10px rgba(153, 153, 255, 0.3);
  }

  .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(153, 153, 255, 0.4);
  }

  .btn-secondary {
      background: var(--accent-color);
      color: var(--text-primary);
      border: none;
      padding: 0.75rem 2rem;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
  }

  .btn-secondary:hover {
      background: var(--accent-pink);
      transform: translateY(-2px);
  }

  /* Navbar */
  .navbar {
      background: var(--background);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid var(--primary-light);
      position: sticky;
      top: 0;
      z-index: 100;
  }

  .nav-brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .nav-brand i {
      color: var(--primary-color);
  }

  .nav-user {
      display: flex;
      align-items: center;
      gap: 1rem;
  }

  .user-currency {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--coin-color);
      color: var(--text-primary);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
  }

  .user-currency i {
      color: var(--text-primary);
  }

  .btn-back {
      background: transparent;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.3s;
      font-weight: 600;
  }

  .btn-back:hover {
      color: var(--primary-dark);
  }

  /* Home Container */
  .home-container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
  }

  .welcome-section {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeIn 0.8s ease-out;
  }

  .welcome-section h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .welcome-section p {
      color: var(--text-secondary);
      font-size: 1.1rem;
  }

  /* Pet Section */
  .pet-section {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 3rem;
      text-align: center;
      border: 3px solid var(--accent-color);
      box-shadow: 0 10px 30px rgba(245, 213, 200, 0.3);
  }

  /* Pomodoro */
  .pomodoro-timer {
      background: var(--background);
      border: 2px solid var(--primary-light);
      border-radius: 16px;
      padding: 1.25rem;
      min-width: 260px;
  }

  .pomodoro-mode {
      text-align: center;
      color: var(--primary-color);
      font-weight: 700;
      margin-bottom: 0.5rem;
  }

  .pomodoro-time {
      font-size: 2.5rem;
      text-align: center;
      font-weight: 800;
      color: var(--text-primary);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 0.75rem;
  }

  .pomodoro-controls {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 0.5rem;
  }

  .pomodoro-cycles {
      text-align: center;
      color: var(--text-secondary);
      font-size: 0.9rem;
  }

  .pet-section h2 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-family: 'Space Grotesk', sans-serif;
  }

  .pet-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 3rem;
      flex-wrap: wrap;
  }

  .pet-display {
      position: relative;
      width: 200px;
      height: 200px;
      background: linear-gradient(135deg, var(--accent-color), var(--accent-pink));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 30px rgba(245, 213, 200, 0.4);
  }
  /* accessory overlay position helper */
  .pet-accessory {
      pointer-events: none;
  }

  .pet-avatar {
      font-size: 5rem;
      animation: float 3s ease-in-out infinite;
  }

  .pet-personality {
      position: absolute;
      top: -10px;
      right: -10px;
      background: var(--primary-color);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 600;
  }

  @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
  }

  .pet-info {
      text-align: left;
  }

  .pet-name {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .pet-stats {
      display: flex;
      flex-direction: column;
      gap: 1rem;
  }

  .pet-stat {
      display: flex;
      align-items: center;
      gap: 1rem;
  }

  .pet-stat label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      min-width: 80px;
  }

  .stat-bar {
      flex: 1;
      height: 24px;
      background: var(--grid-color);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      min-width: 200px;
  }

  .stat-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      border-radius: 12px;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
  }

  .pet-evolution {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 0.9rem;
  }

  /* Hearts decoration */
  .hearts {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--accent-heart);
  }

  /* Action Cards */
  .action-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
  }

  .action-card {
      background: var(--background);
      padding: 2rem;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid var(--grid-color);
  }

  .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(153, 153, 255, 0.2);
      border-color: var(--primary-light);
  }

  .card-icon {
      width: 60px;
      height: 60px;
      background: var(--primary-light);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
  }

  .card-icon i {
      color: var(--primary-color);
      font-size: 1.5rem;
  }

  .action-card h3 {
      margin-bottom: 0.5rem;
      font-size: 1.25rem;
      color: var(--primary-color);
  }

  .action-card p {
      color: var(--text-secondary);
      font-size: 0.9rem;
  }

  /* Quick Stats */
  .quick-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 3rem;
  }

  .stat-card {
      background: var(--background);
      padding: 1.5rem;
      border-radius: 15px;
      text-align: center;
      border-left: 4px solid var(--primary-color);
      box-shadow: 0 4px 10px rgba(153, 153, 255, 0.1);
  }

  .stat-card h4 {
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
  }

  .stat-card span {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  /* Tasks Section */
  .tasks-section {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--grid-color);
  }

  .tasks-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
  }

  .tasks-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .tasks-filters {
      display: flex;
      gap: 0.5rem;
  }

  .filter-btn {
      background: transparent;
      border: 2px solid var(--primary-light);
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9rem;
      font-weight: 600;
  }

  .filter-btn.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
  }

  .filter-btn:hover:not(.active) {
      border-color: var(--primary-color);
      color: var(--primary-color);
  }

  .tasks-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      max-height: 500px;
      overflow-y: auto;
  }

  .task-item {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s;
      border: 2px solid transparent;
  }

  .task-item:hover {
      border-color: var(--primary-light);
      transform: translateX(5px);
  }

  .task-item.completed {
      opacity: 0.7;
      background: var(--grid-color);
  }

  .task-item.overdue {
      border-color: var(--danger-color);
      background: rgba(255, 122, 122, 0.1);
  }

  .task-item.completed .task-info h4 {
      text-decoration: line-through;
  }

  .task-info {
      flex: 1;
  }

  .task-info h4 {
      margin-bottom: 0.5rem;
      font-size: 1.1rem;
      color: var(--text-primary);
  }

  .task-meta {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
  }

  .task-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
  }

  .badge-category {
      background: var(--primary-light);
      color: var(--primary-dark);
  }

  .badge-priority-low {
      background: rgba(125, 216, 125, 0.2);
      color: var(--success-color);
  }

  .badge-priority-medium {
      background: rgba(255, 179, 102, 0.2);
      color: var(--warning-color);
  }

  .badge-priority-high {
      background: rgba(255, 122, 122, 0.2);
      color: var(--danger-color);
  }

  .badge-points {
      background: var(--accent-color);
      color: var(--text-primary);
  }

  .badge-recurring {
      background: var(--accent-pink);
      color: var(--text-primary);
  }

  .badge-due-date {
      background: var(--grid-color);
      color: var(--text-primary);
  }

  .badge-overdue {
      background: rgba(255, 122, 122, 0.2);
      color: var(--danger-color);
  }

  .task-actions {
      display: flex;
      gap: 0.5rem;
  }

  .task-btn {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 10px;
      transition: all 0.3s;
  }

  .task-btn:hover {
      background: var(--grid-color);
      color: var(--text-primary);
  }

  .task-btn.complete {
      color: var(--success-color);
  }

  .task-btn.edit {
      color: var(--primary-color);
  }

  .task-btn.delete {
      color: var(--danger-color);
  }

  /* Quick Add Page */
  .quick-add-container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
  }

  .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
  }

  .category-card {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--grid-color);
      transition: all 0.3s;
  }

  .category-card:hover {
      border-color: var(--primary-light);
      box-shadow: 0 10px 30px rgba(153, 153, 255, 0.2);
  }

  .category-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      text-align: center;
  }

  .category-card h3 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-family: 'Space Grotesk', sans-serif;
  }

  .task-templates {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
  }

  .template-btn {
      background: var(--card-bg);
      border: 2px solid var(--grid-color);
      color: var(--text-primary);
      padding: 0.75rem 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
  }

  .template-btn:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
      color: white;
      transform: translateY(-2px);
  }

  /* Create Task Page */
  .create-task-container {
      max-width: 800px;
      margin: 2rem auto;
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--primary-light);
  }

  .form-group {
      margin-bottom: 1.5rem;
  }

  .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--primary-color);
  }

  .duration-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
  }

  .duration-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
  }

  .duration-input {
      display: flex;
      flex-direction: column;
  }

  .duration-input label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
  }

  .duration-input input {
      padding: 0.5rem;
  }

  .recurring-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
  }

  .recurring-option input[type="checkbox"] {
      width: auto;
      accent-color: var(--primary-color);
  }

  .recurring-details {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 12px;
      border: 1px solid var(--grid-color);
  }

  .days-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 0.5rem;
      margin-top: 0.5rem;
  }

  .day-option {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      padding: 0.5rem;
      background: var(--background);
      border-radius: 8px;
      transition: all 0.3s;
      border: 1px solid var(--grid-color);
  }

  .day-option:hover {
      background: var(--primary-light);
  }

  .day-option input[type="checkbox"] {
      width: auto;
      accent-color: var(--primary-color);
  }

  .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
  }

  /* Statistics Page Styles */
  .stats-container {
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
  }

  .stats-header {
      text-align: center;
      margin-bottom: 3rem;
  }

  .stats-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 1rem;
  }

  .stats-filters {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 3rem;
  }

  .stats-overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
  }

  .stat-overview-card {
      background: var(--background);
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
      border: 2px solid var(--primary-light);
      box-shadow: 0 4px 10px rgba(153, 153, 255, 0.1);
  }

  .stat-overview-card h3 {
      color: var(--text-secondary);
      font-size: 1rem;
      margin-bottom: 1rem;
  }

  .stat-overview-card span {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
  }

  .chart-card {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--grid-color);
  }

  .chart-card h3 {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-family: 'Space Grotesk', sans-serif;
  }

  .chart-placeholder {
      height: 340px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--card-bg);
      border-radius: 12px;
      position: relative;
      overflow: visible;
  }

  .bar-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 100%;
      padding: 20px;
      padding-bottom: 48px; /* space for weekday labels */
      gap: 16px;
  }

  .bar {
      flex: 1;
      background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
      border-radius: 8px 8px 0 0;
      min-height: 20px;
      position: relative;
      transition: all 0.3s;
      cursor: pointer;
  }

  .bar:hover {
      opacity: 0.8;
      transform: translateY(-5px);
  }

  .bar-label {
      position: absolute;
      bottom: -6px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: var(--text-secondary);
      white-space: nowrap;
  }

  .bar-value {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--primary-color);
  }

  .category-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      padding: 1rem;
  }

  .category-stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: var(--card-bg);
      border-radius: 12px;
      border-left: 4px solid var(--primary-color);
  }

  .category-stat-item span:first-child {
      color: var(--text-primary);
      font-weight: 500;
  }

  .category-stat-item span:last-child {
      color: var(--primary-color);
      font-weight: 700;
  }

  /* Calendar Styles */
  .calendar-container {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      margin-top: 2rem;
      border: 2px solid var(--primary-light);
  }

  .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
  }

  .calendar-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .calendar-nav {
      background: transparent;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      transition: all 0.3s;
  }

  .calendar-nav:hover {
      background: var(--primary-light);
  }

  .calendar-grid {
      display: flex;
      flex-direction: column;
  }

  .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
  }

  .calendar-weekdays div {
      text-align: center;
      font-weight: 600;
      color: var(--primary-color);
      padding: 0.5rem;
  }

  .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
  }

  .calendar-day {
      aspect-ratio: 1;
      background: var(--card-bg);
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      border: 2px solid transparent;
  }

  .calendar-day:hover {
      background: var(--primary-light);
      border-color: var(--primary-color);
  }

  .calendar-day.other-month {
      opacity: 0.3;
  }

  .calendar-day.today {
      background: var(--accent-color);
      border-color: var(--accent-pink);
  }

  .calendar-day.has-tasks::after {
      content: '';
      position: absolute;
      bottom: 5px;
      width: 6px;
      height: 6px;
      background: var(--success-color);
      border-radius: 50%;
  }

  .day-number {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-primary);
  }

  .day-tasks-count {
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
  }

  /* Badges Page */
  .badges-container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
  }

  .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 2rem;
  }

  .badge-card {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      border: 2px solid var(--grid-color);
  }

  .badge-card.earned {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, var(--background), var(--card-bg));
  }

  .badge-card.locked {
      opacity: 0.5;
  }

  .badge-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(153, 153, 255, 0.2);
  }

  .badge-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
  }

  .badge-card.earned .badge-icon {
      color: var(--warning-color);
      animation: sparkle 2s infinite;
  }

  @keyframes sparkle {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.1) rotate(5deg); }
  }

  .badge-card.locked .badge-icon {
      color: var(--text-secondary);
  }

  .badge-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-color);
  }

  .badge-description {
      font-size: 0.9rem;
      color: var(--text-secondary);
  }

  .badge-progress {
      margin-top: 1rem;
      font-size: 0.8rem;
      color: var(--primary-color);
  }

  /* Accessories Page */
  .accessories-container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
  }

  .accessories-header {
      text-align: center;
      margin-bottom: 3rem;
  }

  .accessories-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 1rem;
  }

  .accessories-header p {
      color: var(--text-secondary);
  }

  .accessories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 2rem;
  }

  .accessory-card {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s;
      border: 2px solid var(--grid-color);
      position: relative;
  }

  .accessory-card.locked {
      opacity: 0.5;
      filter: grayscale(1);
  }

  .accessory-card.available {
      border-color: var(--primary-color);
  }

  .accessory-card:hover:not(.locked) {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(153, 153, 255, 0.2);
  }

  .accessory-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
  }

  .accessory-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--primary-color);
  }

  .accessory-description {
      font-size: 0.9rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
  }

  .accessory-price {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--coin-color);
      margin-bottom: 1rem;
  }

  .accessory-btn {
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
  }

  .accessory-btn:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-2px);
  }

  .accessory-btn:disabled {
      background: var(--text-secondary);
      cursor: not-allowed;
  }

  .accessory-owned {
      background: var(--success-color);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
  }

  /* Housing Page */
  .housing-container {
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
  }

  .housing-header {
      text-align: center;
      margin-bottom: 3rem;
  }

  .housing-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 1rem;
  }

  .housing-header p {
      color: var(--text-secondary);
  }

  .housing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 2rem;
  }

  /* Leaderboard Page */
  .leaderboard-container {
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
  }

  .leaderboard-header {
      text-align: center;
      margin-bottom: 3rem;
  }

  .leaderboard-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 1rem;
  }

  .leaderboard-header p {
      color: var(--text-secondary);
  }

  .leaderboard-tabs {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 3rem;
  }

  .leaderboard-list {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--primary-light);
  }

  /* Community Page */
  .community-container {
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
  }

  .community-header {
      text-align: center;
      margin-bottom: 3rem;
  }

  .community-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
      margin-bottom: 1rem;
  }

  .community-header p {
      color: var(--text-secondary);
  }

  .community-tabs {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 3rem;
  }

  .friends-list,
  .add-friend-form,
  .friend-requests {
      background: var(--background);
      border-radius: 20px;
      padding: 2rem;
      border: 2px solid var(--primary-light);
  }

  /* Evolution Modal */
  .evolution-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(153, 153, 255, 0.1);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
  }

  .evolution-modal.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
  }

  .evolution-content {
      background: var(--background);
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      text-align: center;
      animation: slideUp 0.3s ease-out;
      border: 3px solid var(--primary-light);
      box-shadow: 0 20px 40px rgba(153, 153, 255, 0.3);
      padding: 2rem;
  }

  .evolution-icon {
      font-size: 5rem;
      margin-bottom: 1rem;
      animation: evolution 2s ease-in-out;
  }

  @keyframes evolution {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.5) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
  }

  .evolution-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 1rem;
      font-family: 'Space Grotesk', sans-serif;
  }

  .evolution-message {
      color: var(--text-secondary);
      margin-bottom: 2rem;
      font-size: 1.1rem;
  }

  /* Modal Styles */
  .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(153, 153, 255, 0.1);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 2rem;
  }

  .modal.active {
      display: flex;
      animation: fadeIn 0.3s ease-out;
  }

  .modal-content {
      background: var(--background);
      border-radius: 20px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease-out;
      border: 3px solid var(--primary-light);
      box-shadow: 0 20px 40px rgba(153, 153, 255, 0.3);
  }

  .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
  }

  .modal-header h2 {
      color: var(--primary-color);
      font-family: 'Space Grotesk', sans-serif;
  }

  .modal-close {
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 10px;
      transition: all 0.3s;
  }

  .modal-close:hover {
      background: var(--grid-color);
      color: var(--primary-color);
  }

  #day-tasks-container {
      padding: 1.5rem;
  }

  /* Pet Selection Modal */
  .pet-selection {
      padding: 2rem;
  }

  .pet-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
  }

  .pet-option {
      background: var(--card-bg);
      border: 2px solid var(--grid-color);
      border-radius: 15px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
  }

  .pet-option:hover {
      border-color: var(--primary-color);
      transform: translateY(-5px);
      background: var(--primary-light);
  }

  .pet-option.selected {
      border-color: var(--primary-color);
      background: var(--accent-color);
  }

  .pet-option-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
  }

  .pet-option-name {
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
  }

  .pet-option-personality {
      font-size: 0.8rem;
      color: var(--text-secondary);
  }

  /* Toast Notifications */
  .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: var(--background);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 1rem;
      transform: translateX(400px);
      transition: transform 0.3s ease-out;
      z-index: 2000;
      border: 2px solid var(--primary-light);
  }

  .toast.show {
      transform: translateX(0);
  }

  .toast.success {
      border-left: 4px solid var(--success-color);
  }

  .toast.error {
      border-left: 4px solid var(--danger-color);
  }

  .toast.info {
      border-left: 4px solid var(--primary-color);
  }

  .toast-icon {
      font-size: 1.5rem;
  }

  .toast.success .toast-icon {
      color: var(--success-color);
  }

  .toast.error .toast-icon {
      color: var(--danger-color);
  }

  .toast.info .toast-icon {
      color: var(--primary-color);
  }

  /* Scrollbar Styling */
  ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
  }

  ::-webkit-scrollbar-track {
      background: var(--grid-color);
      border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
      background: var(--primary-light);
      border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-color);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
      .login-container {
          padding: 1rem;
      }

      .logo h1 {
          font-size: 2rem;
      }

      .action-cards {
          grid-template-columns: 1fr;
      }

      .quick-stats {
          grid-template-columns: 1fr;
      }

      .pet-container {
          flex-direction: column;
      }

      .tasks-header {
          flex-direction: column;
          align-items: stretch;
      }

      .tasks-filters {
          justify-content: center;
      }

      .calendar-weekdays,
      .calendar-days {
          font-size: 0.8rem;
      }

      .duration-row {
          grid-template-columns: 1fr;
      }

      .charts-container {
          grid-template-columns: 1fr;
      }

      .stat-overview-card span {
          font-size: 2rem;
      }

      .category-grid {
          grid-template-columns: 1fr;
      }
  }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div id="login-page" class="page active">
      <div class="login-container">
          <div class="login-content">
              <div class="hearts">❤️ ❤️ ❤️</div>
              <div class="logo">
                  <i class="fas fa-egg"></i>
                  <h1>Hatch-a-task</h1>
              </div>
              <p class="subtitle">Your Personal Task Manager with Virtual Pets</p>
              
              <div class="auth-tabs">
                  <button class="tab-btn active" data-tab="login">Login</button>
                  <button class="tab-btn" data-tab="register">Register</button>
              </div>
              
              <!-- Login Form -->
              <form id="login-form" class="auth-form active">
                  <div class="input-group">
                      <input type="text" id="login-username" placeholder="Username" required>
                  </div>
                  <div class="input-group">
                      <input type="password" id="login-password" placeholder="Password" required>
                  </div>
                  <button type="submit" class="btn-primary">
                      <i class="fas fa-sign-in-alt"></i>
                      Login
                  </button>
              </form>
              
              <!-- Register Form -->
              <form id="register-form" class="auth-form">
                  <div class="input-group">
                      <input type="text" id="register-username" placeholder="Username" required>
                  </div>
                  <div class="input-group">
                      <input type="password" id="register-password" placeholder="Password" required>
                  </div>
                  <div class="input-group">
                      <input type="password" id="register-confirm-password" placeholder="Confirm Password" required>
                  </div>
                  <button type="submit" class="btn-primary">
                      <i class="fas fa-user-plus"></i>
                      Register
                  </button>
              </form>
          </div>
      </div>
  </div>

  <!-- Mini Games Page -->
  <div id="minigames-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-minigames">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-gamepad"></i>
              <span>Mini Games</span>
          </div>
      </nav>

      <div class="accessories-container">
          <div class="accessories-header">
              <h2>Arcade</h2>
              <p>Play quick mini games and earn points.</p>
          </div>
          <div class="accessories-grid">
              <div class="accessory-card available" style="grid-column: 1 / -1;">
                  <span class="accessory-icon">🦖</span>
                  <div class="accessory-name">Dino Run</div>
                  <div class="accessory-description">Press Space to jump. Avoid obstacles.</div>
                  <button class="accessory-btn" id="start-runner-game">Play</button>
                  <div id="runner-game-area" style="display:none; position:relative; height:240px; width:100%; margin-top:1rem; background: var(--card-bg); border-radius: 12px; border: 1px solid var(--grid-color); overflow:hidden;">
                      <div id="runner-ground" style="position:absolute; bottom:0; left:0; right:0; height:8px; background: var(--grid-color);"></div>
                      <div id="runner-player" style="position:absolute; bottom:8px; left:20px; width:36px; height:36px; background: var(--primary-color); border-radius:6px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:20px;">🥚</div>
                      <div id="runner-obstacles" style="position:absolute; bottom:8px; left:0; right:0; height:36px;"></div>
                      <div id="runner-score" style="position:absolute; top:10px; right:12px; color: var(--text-secondary); font-weight:700;">0</div>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Home Page -->
  <div id="home-page" class="page">
      <nav class="navbar">
          <div class="nav-brand">
              <i class="fas fa-egg"></i>
              <span>Hatch-a-task</span>
          </div>
          <div class="nav-user">
              <span id="user-display"></span>
              <div class="user-currency">
                  <i class="fas fa-coins"></i>
                  <span id="user-coins">0</span>
              </div>
              <button id="logout-btn" class="btn-secondary">
                  <i class="fas fa-sign-out-alt"></i>
              </button>
          </div>
      </nav>

      <div class="home-container">
          <div class="welcome-section">
              <div class="hearts">❤️ ❤️ ❤️</div>
              <h1>Welcome back, <span id="user-welcome"></span>!</h1>
              <p>Ready to hatch your tasks today?</p>
          </div>

          <!-- Pet Section -->
          <div class="pet-section">
              <h2>Your Companion</h2>
              <div class="pet-container">
                  <div class="pet-display">
                      <div class="pet-avatar" id="pet-avatar">🥚</div>
                      <div class="pet-personality" id="pet-personality"></div>
                  </div>
                  <div class="pet-info">
                      <div class="pet-name" id="pet-name">Choose Your Pet</div>
                      <div class="pet-stats">
                          <div class="pet-stat">
                              <label>Level:</label>
                              <span id="pet-level">1</span>
                          </div>
                          <div class="pet-stat">
                              <label>Health:</label>
                              <div class="stat-bar">
                                  <div class="stat-fill" id="pet-health" style="width: 100%">100%</div>
                              </div>
                          </div>
                          <div class="pet-stat">
                              <label>Experience:</label>
                              <div class="stat-bar">
                                  <div class="stat-fill" id="pet-exp" style="width: 0%">0%</div>
                              </div>
                          </div>
                          <div class="pet-stat">
                              <label>Personality:</label>
                              <span id="pet-personality-text">Unknown</span>
                          </div>
                      </div>
                      <div class="pet-evolution">
                          <small>Complete tasks to hatch and evolve your pet!</small>
                      </div>
                  </div>
              </div>
          </div>

          <div class="action-cards">
              <div class="action-card" id="create-task-btn">
                  <div class="card-icon">
                      <i class="fas fa-plus"></i>
                  </div>
                  <h3>Create New Task</h3>
                  <p>Add a new task to your list</p>
              </div>

              <div class="action-card" id="quick-add-btn">
                  <div class="card-icon">
                      <i class="fas fa-bolt"></i>
                  </div>
                  <h3>Quick Add</h3>
                  <p>Add predefined tasks quickly</p>
              </div>

              <div class="action-card" id="view-stats-btn">
                  <div class="card-icon">
                      <i class="fas fa-chart-bar"></i>
                  </div>
                  <h3>Statistics & Calendar</h3>
                  <p>Track your progress and achievements</p>
              </div>

              <div class="action-card" id="view-badges-btn">
                  <div class="card-icon">
                      <i class="fas fa-trophy"></i>
                  </div>
                  <h3>Badges Earned</h3>
                  <p>See your accomplishments</p>
              </div>

              <div class="action-card" id="view-accessories-btn">
                  <div class="card-icon">
                      <i class="fas fa-gem"></i>
                  </div>
                  <h3>Accessories</h3>
                  <p>Customize your pet with accessories</p>
              </div>

              <div class="action-card" id="view-minigames-btn">
                  <div class="card-icon">
                      <i class="fas fa-gamepad"></i>
                  </div>
                  <h3>Mini Games</h3>
                  <p>Take a quick break and earn points</p>
              </div>

              <div class="action-card" id="view-leaderboard-btn">
                  <div class="card-icon">
                      <i class="fas fa-medal"></i>
                  </div>
                  <h3>Leaderboard</h3>
                  <p>See how you rank among friends</p>
              </div>

              <div class="action-card" id="view-community-btn">
                  <div class="card-icon">
                      <i class="fas fa-users"></i>
                  </div>
                  <h3>Community</h3>
                  <p>Connect with other users</p>
              </div>
          </div>

          <div class="quick-stats">
              <div class="stat-card">
                  <h4>Total Points</h4>
                  <span id="total-points">0</span>
              </div>
              <div class="stat-card">
                  <h4>Tasks Completed</h4>
                  <span id="tasks-completed">0</span>
              </div>
              <div class="stat-card">
                  <h4>Current Streak</h4>
                  <span id="current-streak">0 days</span>
              </div>
              <div class="stat-card">
                  <h4>Completion Rate</h4>
                  <span id="completion-rate">0%</span>
              </div>
          </div>

          <!-- Pomodoro Section -->
          <div class="pet-section" id="pomodoro-section" style="margin-top: 1rem;">
              <h2>Focus Timer</h2>
              <div class="pet-container" style="gap: 1.5rem;">
                  <div class="pomodoro-timer" id="pomodoro-timer">
                      <div class="pomodoro-mode" id="pomodoro-mode">Focus</div>
                      <div class="pomodoro-time" id="pomodoro-time">25:00</div>
                      <div class="pomodoro-controls">
                          <button class="btn-primary" id="pomodoro-start">Start</button>
                          <button class="btn-secondary" id="pomodoro-pause">Pause</button>
                          <button class="btn-secondary" id="pomodoro-reset">Reset</button>
                      </div>
                      <div class="pomodoro-cycles" id="pomodoro-cycles">Cycle 0</div>
                  </div>
                  <div class="pomodoro-options">
                      <label style="display:block; margin-bottom:0.5rem; color: var(--text-secondary);">Preset</label>
                      <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                          <button class="filter-btn" data-preset="25-5">25/5</button>
                          <button class="filter-btn" data-preset="50-10">50/10</button>
                          <button class="filter-btn" data-preset="90-15">90/15</button>
                      </div>
                  </div>
              </div>
          </div>

          <!-- Tasks Section -->
          <div class="tasks-section">
              <div class="tasks-header">
                  <h2>Your Tasks</h2>
                  <div class="tasks-filters">
                      <button class="filter-btn active" data-filter="all">All</button>
                      <button class="filter-btn" data-filter="pending">Pending</button>
                      <button class="filter-btn" data-filter="completed">Completed</button>
                      <button class="filter-btn" data-filter="overdue">Overdue</button>
                      <button class="filter-btn" data-filter="today">Today</button>
                  </div>
              </div>
              <div class="tasks-container" id="tasks-container">
                  <!-- Tasks will be populated by JavaScript -->
              </div>
          </div>
      </div>
  </div>

  <!-- Quick Add Tasks Page -->
  <div id="quick-add-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-quick">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-bolt"></i>
              <span>Quick Add Tasks</span>
          </div>
      </nav>

      <div class="quick-add-container">
          <div class="form-group" style="max-width: 420px; margin: 0 auto 1.5rem auto;">
              <label for="quick-add-due">Due Date & Time (optional)</label>
              <input type="datetime-local" id="quick-add-due">
          </div>
          <div class="category-grid">
              <div class="category-card" data-category="school">
                  <div class="category-icon">🎓</div>
                  <h3>School</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Attend Class">Attend Class</button>
                      <button class="template-btn" data-task="Study for Exam">Study for Exam</button>
                      <button class="template-btn" data-task="Complete Assignment">Complete Assignment</button>
                      <button class="template-btn" data-task="Group Project">Group Project</button>
                  </div>
              </div>

              <div class="category-card" data-category="work">
                  <div class="category-icon">💼</div>
                  <h3>Work</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Team Meeting">Team Meeting</button>
                      <button class="template-btn" data-task="Project Deadline">Project Deadline</button>
                      <button class="template-btn" data-task="Client Call">Client Call</button>
                      <button class="template-btn" data-task="Report Review">Report Review</button>
                  </div>
              </div>

              <div class="category-card" data-category="personal">
                  <div class="category-icon">👤</div>
                  <h3>Personal</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Exercise">Exercise</button>
                      <button class="template-btn" data-task="Read Book">Read Book</button>
                      <button class="template-btn" data-task="Meditation">Meditation</button>
                      <button class="template-btn" data-task="Call Family">Call Family</button>
                  </div>
              </div>

              <div class="category-card" data-category="hobbies">
                  <div class="category-icon">🎨</div>
                  <h3>Hobbies</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Practice Guitar">Practice Guitar</button>
                      <button class="template-btn" data-task="Paint">Paint</button>
                      <button class="template-btn" data-task="Garden">Garden</button>
                      <button class="template-btn" data-task="Cook New Recipe">Cook New Recipe</button>
                  </div>
              </div>

              <div class="category-card" data-category="fitness">
                  <div class="category-icon">💪</div>
                  <h3>Fitness</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Morning Run">Morning Run</button>
                      <button class="template-btn" data-task="Gym Workout">Gym Workout</button>
                      <button class="template-btn" data-task="Yoga Session">Yoga Session</button>
                      <button class="template-btn" data-task="Swimming">Swimming</button>
                  </div>
              </div>

              <div class="category-card" data-category="other">
                  <div class="category-icon">📝</div>
                  <h3>Other</h3>
                  <div class="task-templates">
                      <button class="template-btn" data-task="Custom Task">Custom Task</button>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Create Task Page -->
  <div id="create-task-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-plus"></i>
              <span>Create New Task</span>
          </div>
      </nav>

      <div class="create-task-container">
          <form id="task-form">
              <div class="form-group">
                  <label for="task-name">Task Name</label>
                  <input type="text" id="task-name" placeholder="Enter task name" required>
              </div>

              <div class="form-group">
                  <label for="task-description">Description (Optional)</label>
                  <textarea id="task-description" placeholder="Add a description for your task"></textarea>
              </div>

              <div class="form-group">
                  <label for="task-category">Category</label>
                  <select id="task-category" required>
                      <option value="">Select a category</option>
                      <option value="school">School</option>
                      <option value="work">Work</option>
                      <option value="personal">Personal</option>
                      <option value="hobbies">Hobbies</option>
                      <option value="fitness">Fitness</option>
                      <option value="other">Other</option>
                  </select>
                  <div id="custom-category-container" style="display: none;">
                      <input type="text" id="custom-category" placeholder="Enter custom category name" class="custom-category-input">
                  </div>
              </div>

              <div class="form-group">
                  <label for="task-priority">Priority Level</label>
                  <select id="task-priority" required>
                      <option value="">Select priority level</option>
                      <option value="low">Low Priority (7 points)</option>
                      <option value="medium">Medium Priority (15 points)</option>
                      <option value="high">High Priority (20 points)</option>
                  </select>
              </div>

              <div class="form-group">
                  <label for="task-due-date">Due Date & Time</label>
                  <input type="datetime-local" id="task-due-date" required>
              </div>

              <div class="form-group">
                  <label for="task-duration">Task Duration</label>
                  <div class="duration-container">
                      <div class="duration-row">
                          <div class="duration-input">
                              <label>Hours</label>
                              <input type="number" id="duration-hours" min="0" max="24" placeholder="0">
                          </div>
                          <div class="duration-input">
                              <label>Minutes</label>
                              <input type="number" id="duration-minutes" min="0" max="59" placeholder="0">
                          </div>
                      </div>
                  </div>
              </div>

              <div class="form-group">
                  <label for="task-recurring">Recurring Task</label>
                  <div class="recurring-options">
                      <label class="recurring-option">
                          <input type="checkbox" id="is-recurring">
                          <span>Make this a recurring task</span>
                      </label>
                      <div id="recurring-details" class="recurring-details" style="display: none;">
                          <div class="recurring-days">
                              <label>Repeat on these days:</label>
                              <div class="days-grid">
                                  <label class="day-option">
                                      <input type="checkbox" value="monday">
                                      <span>Mon</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="tuesday">
                                      <span>Tue</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="wednesday">
                                      <span>Wed</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="thursday">
                                      <span>Thu</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="friday">
                                      <span>Fri</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="saturday">
                                      <span>Sat</span>
                                  </label>
                                  <label class="day-option">
                                      <input type="checkbox" value="sunday">
                                      <span>Sun</span>
                                  </label>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="form-actions">
                  <button type="button" class="btn-secondary" id="cancel-task">Cancel</button>
                  <button type="submit" class="btn-primary">Create Task</button>
              </div>
          </form>
      </div>
  </div>

  <!-- Statistics Page -->
  <div id="stats-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-stats">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-chart-bar"></i>
              <span>Statistics & Calendar</span>
          </div>
      </nav>

      <div class="stats-container">
          <div class="stats-header">
              <h2>Your Statistics</h2>
          </div>

          <div class="stats-filters">
              <button class="filter-btn active" data-period="week">This Week</button>
              <button class="filter-btn" data-period="month">This Month</button>
              <button class="filter-btn" data-period="year">This Year</button>
              <button class="filter-btn" data-period="all">All Time</button>
          </div>

          <div class="stats-overview">
              <div class="stat-overview-card">
                  <h3>Total Points</h3>
                  <span id="stats-total-points">0</span>
              </div>
              <div class="stat-overview-card">
                  <h3>Tasks Completed</h3>
                  <span id="stats-tasks-completed">0</span>
              </div>
              <div class="stat-overview-card">
                  <h3>Completion Rate</h3>
                  <span id="stats-completion-rate">0%</span>
              </div>
              <div class="stat-overview-card">
                  <h3>Longest Streak</h3>
                  <span id="stats-longest-streak">0 days</span>
              </div>
          </div>

          <div class="charts-container">
              <div class="chart-card">
                  <h3>Tasks Completed This Week</h3>
                  <div class="chart-placeholder">
                      <div class="bar-chart" id="weekly-chart">
                          <!-- Chart will be populated by JavaScript -->
                      </div>
                  </div>
              </div>

              <div class="chart-card">
                  <h3>Tasks by Category</h3>
                  <div class="chart-placeholder">
                      <div class="category-stats" id="category-stats">
                          <!-- Stats will be populated by JavaScript -->
                      </div>
                  </div>
              </div>
          </div>

          <div class="calendar-container">
              <div class="calendar-header">
                  <button id="prev-month" class="calendar-nav">
                      <i class="fas fa-chevron-left"></i>
                  </button>
                  <h2 id="calendar-title">January 2024</h2>
                  <button id="next-month" class="calendar-nav">
                      <i class="fas fa-chevron-right"></i>
                  </button>
              </div>
              <div class="calendar-grid">
                  <div class="calendar-weekdays">
                      <div>Sun</div>
                      <div>Mon</div>
                      <div>Tue</div>
                      <div>Wed</div>
                      <div>Thu</div>
                      <div>Fri</div>
                      <div>Sat</div>
                  </div>
                  <div id="calendar-days" class="calendar-days"></div>
              </div>
          </div>
      </div>
  </div>

  <!-- Badges Page -->
  <div id="badges-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-badges">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-trophy"></i>
              <span>Badges Earned</span>
          </div>
      </nav>

      <div class="badges-container">
          <div class="badges-grid" id="badges-grid"></div>
      </div>
  </div>

  <!-- Accessories Page -->
  <div id="accessories-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-accessories">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-gem"></i>
              <span>Pet Accessories</span>
          </div>
      </nav>

      <div class="accessories-container">
          <div class="accessories-header">
              <h2>Pet Accessories</h2>
              <p>Unlock accessories at level 20 and customize your pet!</p>
          </div>
          <div class="accessories-grid" id="accessories-grid">
              <!-- Accessories will be populated by JavaScript -->
          </div>
      </div>
  </div>

  

  <!-- Leaderboard Page -->
  <div id="leaderboard-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-leaderboard">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-medal"></i>
              <span>Leaderboard</span>
          </div>
      </nav>

      <div class="leaderboard-container">
          <div class="leaderboard-header">
              <h2>Global Leaderboard</h2>
              <p>See how you rank among all users!</p>
          </div>
          <div class="leaderboard-tabs">
              <button class="tab-btn active" data-tab="points">Points</button>
              <button class="tab-btn" data-tab="streak">Streak</button>
              <button class="tab-btn" data-tab="tasks">Tasks</button>
          </div>
          <div class="leaderboard-list" id="leaderboard-list">
              <!-- Leaderboard will be populated by JavaScript -->
          </div>
      </div>
  </div>

  <!-- Community Page -->
  <div id="community-page" class="page">
      <nav class="navbar">
          <button class="btn-back" id="back-to-home-community">
              <i class="fas fa-arrow-left"></i>
              Back
          </button>
          <div class="nav-brand">
              <i class="fas fa-users"></i>
              <span>Community</span>
          </div>
      </nav>

      <div class="community-container">
          <div class="community-header">
              <h2>Community</h2>
              <p>Connect with other users and make friends!</p>
          </div>
          
          <div class="community-tabs">
              <button class="tab-btn active" data-tab="friends">Friends</button>
              <button class="tab-btn" data-tab="add-friend">Add Friend</button>
              <button class="tab-btn" data-tab="requests">Friend Requests</button>
          </div>
          
          <div class="friends-list" id="friends-list">
              <!-- Friends will be populated by JavaScript -->
          </div>
          
          <div class="add-friend-form" id="add-friend-form" style="display: none;">
              <h3>Add New Friend</h3>
              <div class="input-group">
                  <input type="text" id="friend-username" placeholder="Enter username" required>
                  <button id="send-friend-request" class="btn-primary">Send Request</button>
              </div>
          </div>
          
          <div class="friend-requests" id="friend-requests" style="display: none;">
              <h3>Friend Requests</h3>
              <div id="requests-list">
                  <!-- Requests will be populated by JavaScript -->
              </div>
          </div>
      </div>
  </div>

  <!-- Pet Selection Modal -->
  <div id="pet-selection-modal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Choose Your Companion</h2>
          </div>
          <div class="pet-selection">
              <p>Select a pet to accompany you on your productivity journey!</p>
              <div class="pet-options">
                  <div class="pet-option" data-pet="dragon">
                      <div class="pet-option-icon">🐉</div>
                      <div class="pet-option-name">Dragon</div>
                      <div class="pet-option-personality">Brave & Ambitious</div>
                  </div>
                  <div class="pet-option" data-pet="fox">
                      <div class="pet-option-icon">🦊</div>
                      <div class="pet-option-name">Nine-Tail Fox</div>
                      <div class="pet-option-personality">Wise & Mysterious</div>
                  </div>
                  <div class="pet-option" data-pet="phoenix">
                      <div class="pet-option-icon">🦅</div>
                      <div class="pet-option-name">Phoenix</div>
                      <div class="pet-option-personality">Resilient & Reborn</div>
                  </div>
                  <div class="pet-option" data-pet="unicorn">
                      <div class="pet-option-icon">🦄</div>
                      <div class="pet-option-name">Unicorn</div>
                      <div class="pet-option-personality">Pure & Magical</div>
                  </div>
                  <div class="pet-option" data-pet="wolf">
                      <div class="pet-option-icon">🐺</div>
                      <div class="pet-option-name">Wolf</div>
                      <div class="pet-option-personality">Loyal & Strong</div>
                  </div>
                  <div class="pet-option" data-pet="tiger">
                      <div class="pet-option-icon">🐅</div>
                      <div class="pet-option-name">Tiger</div>
                      <div class="pet-option-personality">Fierce & Determined</div>
                  </div>
              </div>
              <div class="form-actions">
                  <button id="confirm-pet" class="btn-primary" disabled>Choose Pet</button>
              </div>
          </div>
      </div>
  </div>

  <!-- Evolution Modal -->
  <div id="evolution-modal" class="evolution-modal">
      <div class="evolution-content">
          <div class="evolution-icon" id="evolution-icon">🥚</div>
          <div class="evolution-title" id="evolution-title">Your Pet is Hatching!</div>
          <div class="evolution-message" id="evolution-message">Congratulations! Your pet has reached a new milestone.</div>
          <button class="btn-primary" onclick="closeEvolutionModal()">Continue</button>
      </div>
  </div>

  <!-- Day Tasks Modal -->
  <div id="day-tasks-modal" class="modal">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Tasks for <span id="selected-date"></span></h2>
              <button class="modal-close" id="close-day-tasks-modal">
                  <i class="fas fa-times"></i>
              </button>
          </div>
          <div id="day-tasks-container">
              <!-- Tasks will be populated by JavaScript -->
          </div>
      </div>
  </div>

  <!-- Toast Container -->
  <div id="toast" class="toast">
      <i class="toast-icon"></i>
      <span class="toast-message"></span>
  </div>

  <script>
  // Pet evolution map
  function getPetBase(type) {
      const PETS = {
          dragon: {
              name: 'Dragon', personality: 'Brave & Ambitious',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Dragon Hatchling' },
                  { level: 3, emoji: '🐲', name: 'Wyrmling' },
                  { level: 7, emoji: '🐉', name: 'Young Dragon' },
                  { level: 12, emoji: '🐉', name: 'Ancient Dragon' }
              ]
          },
          fox: {
              name: 'Nine-Tail Fox', personality: 'Wise & Mysterious',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Fox Pup' },
                  { level: 3, emoji: '🦊', name: 'Mystic Fox' },
                  { level: 7, emoji: '🦊', name: 'Nine-Tail Fox' },
                  { level: 12, emoji: '🦊', name: 'Elder Kitsune' }
              ]
          },
          phoenix: {
              name: 'Phoenix', personality: 'Resilient & Reborn',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Ash Chick' },
                  { level: 3, emoji: '🐥', name: 'Flamebird' },
                  { level: 7, emoji: '🦅', name: 'Phoenix' },
                  { level: 12, emoji: '🦅', name: 'Eternal Phoenix' }
              ]
          },
          unicorn: {
              name: 'Unicorn', personality: 'Pure & Magical',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Foal' },
                  { level: 3, emoji: '🐴', name: 'Young Unicorn' },
                  { level: 7, emoji: '🦄', name: 'Unicorn' },
                  { level: 12, emoji: '🦄', name: 'Celestial Unicorn' }
              ]
          },
          wolf: {
              name: 'Wolf', personality: 'Loyal & Strong',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Wolf Pup' },
                  { level: 3, emoji: '🐶', name: 'Young Wolf' },
                  { level: 7, emoji: '🐺', name: 'Dire Wolf' },
                  { level: 12, emoji: '🐺', name: 'Alpha Wolf' }
              ]
          },
          tiger: {
              name: 'Tiger', personality: 'Fierce & Determined',
              stages: [
                  { level: 1, emoji: '🐣', name: 'Tiger Cub' },
                  { level: 3, emoji: '🐯', name: 'Young Tiger' },
                  { level: 7, emoji: '🐅', name: 'Tiger' },
                  { level: 12, emoji: '🐅', name: 'Celestial Tiger' }
              ]
          }
      };
      return PETS[type] || { name: 'Buddy', personality: 'Friendly', stages: [ { level: 1, emoji: '🐣', name: 'Buddy' }, { level: 5, emoji: '🐤', name: 'Buddy Jr.' }, { level: 10, emoji: '🐥', name: 'Buddy Prime' } ] };
  }

  function maybeEvolvePet() {
      if (!state.pet || !state.pet.type) return;
      const base = getPetBase(state.pet.type);
      // Find highest stage where level threshold <= current level
      let newStageIndex = 0;
      for (let i = 0; i < base.stages.length; i++) {
          if ((state.pet.level || 1) >= base.stages[i].level) newStageIndex = i;
      }
      const desired = base.stages[newStageIndex];
      const nameForStage = desired.name || state.pet.name;
      const avatarForStage = desired.emoji;
      const stageChanged = newStageIndex !== state.pet.stage;
      const needsSync = state.pet.name !== nameForStage || state.pet.avatar !== avatarForStage || stageChanged;
      if (!needsSync) return;
      state.pet.stage = newStageIndex;
      state.pet.avatar = avatarForStage;
      state.pet.name = nameForStage;
      save();
      updatePetUI();
      if (stageChanged) {
          // evolution modal only when stage actually changes
          const modal = document.getElementById('evolution-modal');
          const icon = document.getElementById('evolution-icon');
          const title = document.getElementById('evolution-title');
          const msg = document.getElementById('evolution-message');
          if (modal && icon && title && msg) {
              icon.textContent = state.pet.avatar;
              title.textContent = 'Evolution!';
              msg.textContent = `${state.pet.name} reached Stage ${(state.pet.stage || 0) + 1}!`;
              modal.classList.add('active');
          }
      }
  }
  // Hatch-a-task Client Logic

  // Global state
  const state = {
      currentUser: null,
      tasks: [],
      completedTasks: [],
      totalPoints: 0,
      coins: 0,
      currentStreak: 0,
      longestStreak: 0,
      categoryStats: {},
      housingOwned: [],
      accessoriesOwned: [],
      accessoryEquipped: null,
      pet: {
          type: null,
          name: null,
          personality: null,
          avatar: '🥚',
          stage: 0,
          level: 1,
          exp: 0
      },
      pomodoro: {
          focusMinutes: 25,
          breakMinutes: 5,
          isRunning: false,
          isBreak: false,
          remainingSeconds: 25 * 60,
          cycles: 0,
          timerId: null
      }
  };

  // Persistence
  const STORAGE_KEY = 'hatchATaskStateV2';
  const USERS_KEY = 'hat_users_v1';

  function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function load() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      try {
          const data = JSON.parse(raw);
          Object.assign(state, data);
          // Ensure new fields exist
          state.categoryStats = state.categoryStats || {};
          state.housingOwned = state.housingOwned || [];
          state.accessoriesOwned = state.accessoriesOwned || [];
          state.accessoryEquipped = state.accessoryEquipped || null;
          state.pet = Object.assign({ type: null, name: null, personality: null, avatar: '🥚', stage: 0, level: 1, exp: 0 }, state.pet || {});
          state.pomodoro = Object.assign({
              focusMinutes: 25,
              breakMinutes: 5,
              isRunning: false,
              isBreak: false,
              remainingSeconds: 25 * 60,
              cycles: 0,
              timerId: null
          }, state.pomodoro || {});
      } catch (e) {
          console.warn('Failed to load state', e);
      }
  }

  function loadUsers() {
      try {
          const raw = localStorage.getItem(USERS_KEY);
          if (!raw) return [];
          return JSON.parse(raw);
      } catch (e) {
          return [];
      }
  }

  function saveUsers(users) {
      localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  async function hashPassword(password) {
      const input = new TextEncoder().encode(password + '|pepper_v1');
      if (window.crypto && window.crypto.subtle) {
          const digest = await crypto.subtle.digest('SHA-256', input);
          const hashArr = Array.from(new Uint8Array(digest));
          return hashArr.map(b => b.toString(16).padStart(2, '0')).join('');
      }
      // Fallback
      return btoa(password + '|pepper_v1');
  }

  function validatePasswordStrength(pw) {
      // Basic: at least 8 chars, includes letter and number
      if (!pw || pw.length < 8) return false;
      const hasLetter = /[A-Za-z]/.test(pw);
      const hasNumber = /\d/.test(pw);
      return hasLetter && hasNumber;
  }

  // Page switching
  function switchPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const page = document.getElementById(pageId.replace('#','')) || document.querySelector(pageId);
      if (page) page.classList.add('active');
  }

  // UI Helpers
  function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      if (!toast) return alert(message);
      const icon = toast.querySelector('.toast-icon');
      const msg = toast.querySelector('.toast-message');
      toast.className = `toast ${type} show`;
      msg.textContent = message;
      icon.className = 'toast-icon fas ' + (type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
      setTimeout(() => toast.classList.remove('show'), 2200);
  }

  // Theme (morning/afternoon/night)
  function applyTimeOfDayTheme() {
      const hour = new Date().getHours();
      document.body.classList.remove('theme-morning', 'theme-afternoon', 'theme-night');
      if (hour >= 5 && hour < 12) document.body.classList.add('theme-morning');
      else if (hour >= 12 && hour < 18) document.body.classList.add('theme-afternoon');
      else document.body.classList.add('theme-night');
  }

  // Header/user
  function updateHeader() {
      const u = document.getElementById('user-display');
      const w = document.getElementById('user-welcome');
      const c = document.getElementById('user-coins');
      if (u) u.textContent = state.currentUser ? state.currentUser : '';
      if (w) w.textContent = state.currentUser ? state.currentUser : '';
      if (c) c.textContent = state.coins;
      updatePetUI();
  }

  // Stats (home quick stats + stats page)
  function updateStats() {
      const totalTasks = state.tasks.length + state.completedTasks.length;
      const completionRate = totalTasks > 0 ? Math.round((state.completedTasks.length / totalTasks) * 100) : 0;

      setText('total-points', state.totalPoints);
      setText('tasks-completed', state.completedTasks.length);
      setText('current-streak', `${state.currentStreak} days`);
      setText('completion-rate', `${completionRate}%`);

      // Stats page cards
      setText('stats-total-points', sumPointsInPeriod());
      setText('stats-tasks-completed', countTasksInPeriod());
      setText('stats-completion-rate', `${completionRate}%`);
      setText('stats-longest-streak', `${state.longestStreak} days`);

      renderWeeklyChart();
      renderCategoryStats();
  }

  function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
  }

  function sumPointsInPeriod() {
      const periodBtn = document.querySelector('.stats-filters .filter-btn.active');
      const period = periodBtn ? periodBtn.dataset.period : 'week';
      const [start, end] = getPeriodRange(period);
      return state.completedTasks
          .filter(t => new Date(t.completedDate) >= start && new Date(t.completedDate) <= end)
          .reduce((s, t) => s + (t.points || 0), 0);
  }

  function countTasksInPeriod() {
      const periodBtn = document.querySelector('.stats-filters .filter-btn.active');
      const period = periodBtn ? periodBtn.dataset.period : 'week';
      const [start, end] = getPeriodRange(period);
      return state.completedTasks
          .filter(t => new Date(t.completedDate) >= start && new Date(t.completedDate) <= end)
          .length;
  }

  function computeAvgDaily() {
      const periodBtn = document.querySelector('.stats-filters .filter-btn.active');
      const period = periodBtn ? periodBtn.dataset.period : 'week';
      const [start, end] = getPeriodRange(period);
      const days = Math.max(1, Math.ceil((end - start) / 86400000));
      return (countTasksInPeriod() / days).toFixed(1);
  }

  function getPeriodRange(period) {
      const end = new Date();
      const start = new Date();
      if (period === 'week') start.setDate(start.getDate() - 7);
      else if (period === 'month') start.setMonth(start.getMonth() - 1);
      else if (period === 'year') start.setFullYear(start.getFullYear() - 1);
      else if (period === 'all') start.setTime(0);
      return [start, end];
  }

  // Weekly chart
  function renderWeeklyChart() {
      const container = document.getElementById('weekly-chart');
      if (!container) return;
      container.innerHTML = '';
      const today = new Date();
      const counts = [];
      const labels = [];
      for (let i = 6; i >= 0; i--) {
          const d = new Date(today);
          d.setDate(today.getDate() - i);
          const dayStr = d.toDateString();
          const count = state.completedTasks.filter(t => new Date(t.completedDate).toDateString() === dayStr).length;
          labels.push(d.toLocaleDateString('en-US', { weekday: 'short' }));
          counts.push(count);
      }
      const max = Math.max(1, ...counts);
      labels.forEach((label, idx) => {
          const barContainer = document.createElement('div');
          barContainer.style.position = 'relative';
          barContainer.style.flex = '1';
          barContainer.style.minWidth = '36px';
          barContainer.style.display = 'flex';
          barContainer.style.flexDirection = 'column';
          barContainer.style.alignItems = 'center';
          barContainer.style.justifyContent = 'flex-end';
          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.height = `${Math.max(20, (counts[idx] / max) * 250)}px`;
          const value = document.createElement('span');
          value.className = 'bar-value';
          value.textContent = counts[idx];
          const lbl = document.createElement('span');
          lbl.className = 'bar-label';
          lbl.textContent = label;
          bar.appendChild(value);
          bar.appendChild(lbl);
          barContainer.appendChild(bar);
          container.appendChild(barContainer);
      });
  }

  // Category stats
  function renderCategoryStats() {
      const container = document.getElementById('category-stats');
      if (!container) return;
      container.innerHTML = '';
      // Build from completed tasks
      const counts = {};
      state.completedTasks.forEach(t => {
          const cat = (t.category || 'other');
          counts[cat] = (counts[cat] || 0) + 1;
      });
      const entries = Object.entries(counts).sort((a,b) => b[1]-a[1]);
      if (entries.length === 0) {
          container.innerHTML = '<p style="text-align:center; color: var(--text-secondary); grid-column: 1 / -1;">No category data yet</p>';
          return;
      }
      entries.forEach(([cat, n]) => {
          const div = document.createElement('div');
          div.className = 'category-stat-item';
          div.innerHTML = `<span>${cat.replace(/-/g,' ')}</span><span>${n} tasks</span>`;
          container.appendChild(div);
      });
  }

  // Calendar
  let calMonth = new Date().getMonth();
  let calYear = new Date().getFullYear();

  function renderCalendar() {
      const daysEl = document.getElementById('calendar-days');
      const titleEl = document.getElementById('calendar-title');
      if (!daysEl || !titleEl) return;
      const first = new Date(calYear, calMonth, 1);
      const last = new Date(calYear, calMonth + 1, 0);
      const prevLast = new Date(calYear, calMonth, 0);
      const firstDayIndex = first.getDay();
      const prevDays = prevLast.getDate();
      const lastDate = last.getDate();
      const lastDayIndex = last.getDay();
      const nextDays = 7 - lastDayIndex - 1;
      titleEl.textContent = first.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      daysEl.innerHTML = '';
      for (let x = firstDayIndex; x > 0; x--) {
          const d = document.createElement('div');
          d.className = 'calendar-day other-month';
          d.innerHTML = `<span class="day-number">${prevDays - x + 1}</span>`;
          daysEl.appendChild(d);
      }
      const today = new Date();
      for (let i = 1; i <= lastDate; i++) {
          const d = document.createElement('div');
          d.className = 'calendar-day';
          const current = new Date(calYear, calMonth, i);
          if (i === today.getDate() && calMonth === today.getMonth() && calYear === today.getFullYear()) {
              d.classList.add('today');
          }
          const completed = state.completedTasks.filter(t => new Date(t.completedDate).toDateString() === current.toDateString());
          if (completed.length > 0) {
              d.classList.add('has-tasks');
              d.innerHTML = `<span class="day-number">${i}</span><span class="day-tasks-count">${completed.length}</span>`;
          } else {
              d.innerHTML = `<span class="day-number">${i}</span>`;
          }
          d.addEventListener('click', () => showDayTasks(current));
          daysEl.appendChild(d);
      }
      for (let j = 1; j <= nextDays; j++) {
          const d = document.createElement('div');
          d.className = 'calendar-day other-month';
          d.innerHTML = `<span class="day-number">${j}</span>`;
          daysEl.appendChild(d);
      }
  }

  // Calendar day modal
  function showDayTasks(date) {
      const modal = document.getElementById('day-tasks-modal');
      const container = document.getElementById('day-tasks-container');
      const selectedDateEl = document.getElementById('selected-date');
      if (!modal || !container || !selectedDateEl) return;
      selectedDateEl.textContent = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
      const items = state.completedTasks.filter(t => new Date(t.completedDate).toDateString() === date.toDateString());
      if (items.length === 0) {
          container.innerHTML = '<p style="padding: 1rem; text-align: center; color: var(--text-secondary);">No tasks completed on this day</p>';
      } else {
          container.innerHTML = items.map(task => `
              <div class="task-item completed" style="margin: 0.5rem 0;">
                  <div class="task-info">
                      <h4>${task.name}</h4>
                      <div class="task-meta">
                          <span class="task-badge badge-points">${task.points} pts</span>
                          ${task.category ? `<span class="task-badge badge-category">${task.category}</span>` : ''}
                      </div>
                  </div>
              </div>
          `).join('');
      }
      modal.classList.add('active');
  }

  // Tasks
  function renderTasks() {
      const container = document.getElementById('tasks-container');
      if (!container) return;
      container.innerHTML = '';
      const activeFilter = document.querySelector('.tasks-filters .filter-btn.active');
      const filter = activeFilter ? activeFilter.dataset.filter : 'all';
      let list = [];
      if (filter === 'all') list = [...state.tasks, ...state.completedTasks];
      else if (filter === 'pending') list = state.tasks;
      else if (filter === 'completed') list = state.completedTasks;
      else if (filter === 'overdue') list = state.tasks.filter(t => new Date(t.dueDate) < new Date());
      else if (filter === 'today') list = state.tasks.filter(t => new Date(t.dueDate).toDateString() === new Date().toDateString());
      list.sort((a,b) => (a.completed?1:0)-(b.completed?1:0) || new Date(a.dueDate) - new Date(b.dueDate));
      if (list.length === 0) {
          container.innerHTML = '<p style="text-align:center; color: var(--text-secondary);">No tasks found</p>';
          return;
      }
      list.forEach(task => {
          const el = document.createElement('div');
          el.className = `task-item ${task.completed ? 'completed' : ''}`;
          el.innerHTML = `
              <div class="task-info">
                  <h4>${task.name}</h4>
                  <div class="task-meta">
                      <span class="task-badge badge-category">${(task.category||'other').replace(/-/g,' ')}</span>
                      <span class="task-badge badge-points">${task.points} pts</span>
                      ${task.dueDate ? `<span class="task-badge badge-due-date">Due: ${new Date(task.dueDate).toLocaleString()}</span>` : ''}
                  </div>
              </div>
              <div class="task-actions">
                  ${!task.completed ? `<button class="task-btn complete" data-id="${task.id}"><i class="fas fa-check"></i></button>
                  <button class="task-btn delete" data-id="${task.id}"><i class="fas fa-trash"></i></button>` : '<span style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Completed</span>'}
              </div>
          `;
          container.appendChild(el);
      });
      container.querySelectorAll('.task-btn.complete').forEach(btn => btn.addEventListener('click', () => completeTask(Number(btn.dataset.id))));
      container.querySelectorAll('.task-btn.delete').forEach(btn => btn.addEventListener('click', () => deleteTask(Number(btn.dataset.id))));
  }

  function createTaskFromForm(e) {
      e.preventDefault();
      const name = document.getElementById('task-name').value.trim();
      if (!name) return;
      const category = document.getElementById('task-category').value || 'other';
      const customCategoryInput = document.getElementById('custom-category');
      const customCategory = customCategoryInput ? customCategoryInput.value.trim() : '';
      const priority = document.getElementById('task-priority').value;
      const dueDate = document.getElementById('task-due-date').value;
      const minutes = (parseInt(document.getElementById('duration-hours').value) || 0) * 60 + (parseInt(document.getElementById('duration-minutes').value) || 0);
      const basePoints = priority === 'high' ? 20 : priority === 'medium' ? 15 : 7;
      const durationBonus = minutes >= 120 ? 5 : minutes >= 60 ? 3 : minutes >= 30 ? 2 : 0;
      const task = {
          id: Date.now(),
          name,
          category: category === 'other' && customCategory ? customCategory : category,
          points: basePoints + durationBonus,
          dueDate,
          completed: false
      };
      state.tasks.push(task);
      save();
      showToast('Task created', 'success');
      switchPage('home-page');
      renderTasks();
      updateStats();
      e.target.reset();
  }

  function completeTask(id) {
      const idx = state.tasks.findIndex(t => t.id === id);
      if (idx === -1) return;
      const t = state.tasks[idx];
      t.completed = true;
      t.completedDate = new Date().toISOString();
      state.completedTasks.push(t);
      state.tasks.splice(idx, 1);
      state.totalPoints += t.points;
      // Coins: 1 coin per 10 points
      state.coins += Math.max(1, Math.floor(t.points / 10));
      grantPetExp(t.points);
      bumpStreak();
      save();
      updateHeader();
      renderTasks();
      updateStats();
      showToast(`Task completed! +${t.points} pts`, 'success');
  }

  function deleteTask(id) {
      const idx = state.tasks.findIndex(t => t.id === id);
      if (idx === -1) return;
      state.tasks.splice(idx, 1);
      save();
      renderTasks();
  }

  function bumpStreak() {
      const today = new Date().toDateString();
      const yesterday = new Date(Date.now() - 86400000).toDateString();
      const last = localStorage.getItem('hat_last_completed');
      if (last === yesterday) state.currentStreak += 1;
      else if (last !== today) state.currentStreak = 1;
      if (state.currentStreak > state.longestStreak) state.longestStreak = state.currentStreak;
      localStorage.setItem('hat_last_completed', today);
  }

  // Pomodoro
  function updatePomodoroUI() {
      const modeEl = document.getElementById('pomodoro-mode');
      const timeEl = document.getElementById('pomodoro-time');
      const cyclesEl = document.getElementById('pomodoro-cycles');
      if (!modeEl || !timeEl || !cyclesEl) return;
      modeEl.textContent = state.pomodoro.isBreak ? 'Break' : 'Focus';
      const m = Math.floor(state.pomodoro.remainingSeconds / 60);
      const s = state.pomodoro.remainingSeconds % 60;
      timeEl.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      cyclesEl.textContent = `Cycle ${state.pomodoro.cycles}`;
  }

  function startPomodoro() {
      if (state.pomodoro.isRunning) return;
      state.pomodoro.isRunning = true;
      if (!state.pomodoro.remainingSeconds) state.pomodoro.remainingSeconds = (state.pomodoro.isBreak ? state.pomodoro.breakMinutes : state.pomodoro.focusMinutes) * 60;
      state.pomodoro.timerId = setInterval(() => {
          state.pomodoro.remainingSeconds -= 1;
          if (state.pomodoro.remainingSeconds <= 0) {
              clearInterval(state.pomodoro.timerId);
              state.pomodoro.timerId = null;
              state.pomodoro.isRunning = false;
              // Award on completed session
              if (!state.pomodoro.isBreak) {
                  state.totalPoints += 10;
                  state.coins += 3;
                  state.pomodoro.cycles += 1;
                  grantPetExp(10);
                  showToast('Focus session complete! +10 pts, +3 coins', 'success');
              }
              // Toggle mode
              state.pomodoro.isBreak = !state.pomodoro.isBreak;
              state.pomodoro.remainingSeconds = (state.pomodoro.isBreak ? state.pomodoro.breakMinutes : state.pomodoro.focusMinutes) * 60;
              save();
              updateHeader();
              updateStats();
              updatePomodoroUI();
          } else {
              updatePomodoroUI();
          }
      }, 1000);
  }

  function pausePomodoro() {
      if (!state.pomodoro.isRunning) return;
      clearInterval(state.pomodoro.timerId);
      state.pomodoro.timerId = null;
      state.pomodoro.isRunning = false;
  }

  function resetPomodoro() {
      pausePomodoro();
      state.pomodoro.isBreak = false;
      state.pomodoro.remainingSeconds = state.pomodoro.focusMinutes * 60;
      updatePomodoroUI();
  }

  function setPomodoroPreset(focus, brk) {
      state.pomodoro.focusMinutes = focus;
      state.pomodoro.breakMinutes = brk;
      state.pomodoro.isBreak = false;
      state.pomodoro.remainingSeconds = focus * 60;
      pausePomodoro();
      updatePomodoroUI();
  }

  // (Removed old click target minigame)

  // Housing Shop (simple)
  const HOUSING_ITEMS = [
      { id: 'plant', name: 'Potted Plant', price: 15, emoji: '🪴' },
      { id: 'lamp', name: 'Lamp', price: 20, emoji: '🛋️' },
      { id: 'poster', name: 'Poster', price: 10, emoji: '🖼️' },
      { id: 'rug', name: 'Rug', price: 25, emoji: '🧶' }
  ];

  function renderHousingShop() {
      const grid = document.getElementById('housing-grid');
      if (!grid) return;
      grid.innerHTML = '';
      HOUSING_ITEMS.forEach(item => {
          const owned = state.housingOwned.includes(item.id);
          const card = document.createElement('div');
          card.className = `accessory-card ${owned ? '' : state.coins >= item.price ? 'available' : 'locked'}`;
          card.innerHTML = `
              <span class="accessory-icon">${item.emoji}</span>
              <div class="accessory-name">${item.name}</div>
              <div class="accessory-price">${item.price} coins</div>
              ${owned ? '<button class="accessory-owned">Owned</button>' : `<button class="accessory-btn" ${state.coins < item.price ? 'disabled' : ''} data-id="${item.id}">${state.coins < item.price ? 'Not enough coins' : 'Buy'}</button>`}
          `;
          grid.appendChild(card);
      });
      grid.querySelectorAll('.accessory-btn').forEach(btn => btn.addEventListener('click', () => purchaseHousing(btn.dataset.id)));
  }

  function purchaseHousing(id) {
      const item = HOUSING_ITEMS.find(i => i.id === id);
      if (!item) return;
      if (state.coins < item.price) return showToast('Not enough coins', 'error');
      state.coins -= item.price;
      if (!state.housingOwned.includes(id)) state.housingOwned.push(id);
      save();
      updateHeader();
      renderHousingShop();
      renderHousingDecor();
      showToast(`Purchased ${item.name}`, 'success');
  }

  function renderHousingDecor() {
      const display = document.querySelector('.pet-display');
      if (!display) return;
      // Remove previous
      display.querySelectorAll('.decor').forEach(d => d.remove());
      // Add each owned item
      state.housingOwned.forEach((id, idx) => {
          const item = HOUSING_ITEMS.find(i => i.id === id);
          if (!item) return;
          const el = document.createElement('div');
          el.className = 'decor';
          el.textContent = item.emoji;
          el.style.position = 'absolute';
          el.style.fontSize = '1.5rem';
          // Position around the edge of the circle roughly
          const angle = (idx / Math.max(1, state.housingOwned.length)) * Math.PI * 2;
          const r = 90; // radius
          el.style.left = `${100 + r * Math.cos(angle)}px`;
          el.style.top = `${100 + r * Math.sin(angle)}px`;
          display.appendChild(el);
      });
      renderAccessoryOnPet();
  }

  // Auth (very light weight demo)
  function initAuth() {
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      const tabBtns = document.querySelectorAll('.auth-tabs .tab-btn');
      tabBtns.forEach(btn => btn.addEventListener('click', () => {
          tabBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
          const tab = btn.dataset.tab;
          document.getElementById(`${tab}-form`).classList.add('active');
      }));
      if (loginForm) loginForm.addEventListener('submit', async e => {
          e.preventDefault();
          const username = document.getElementById('login-username').value.trim();
          const password = document.getElementById('login-password') ? document.getElementById('login-password').value : '';
          if (!username || !password) {
              showToast('Enter username and password', 'error');
              return;
          }
          const users = loadUsers();
          const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());
          if (!user) {
              showToast('Invalid username or password', 'error');
              return;
          }
          const hash = await hashPassword(password);
          if (hash !== user.passwordHash) {
              showToast('Invalid username or password', 'error');
              return;
          }
          state.currentUser = user.username;
          save();
          updateHeader();
          switchPage('home-page');
          updateStats();
          renderTasks();
          renderHousingDecor();
          showToast(`Welcome back, ${user.username}!`, 'success');
      });
      if (registerForm) registerForm.addEventListener('submit', async e => {
          e.preventDefault();
          const username = document.getElementById('register-username').value.trim();
          const password = document.getElementById('register-password').value;
          const confirm = document.getElementById('register-confirm-password').value;
          if (!username || !password || !confirm) {
              showToast('Fill all required fields', 'error');
              return;
          }
          if (password !== confirm) {
              showToast('Passwords do not match', 'error');
              return;
          }
          if (!validatePasswordStrength(password)) {
              showToast('Password must be 8+ chars and include letters and numbers', 'error');
              return;
          }
          const users = loadUsers();
          if (users.some(u => u.username.toLowerCase() === username.toLowerCase())) {
              showToast('Username already exists', 'error');
              return;
          }
          const hash = await hashPassword(password);
          if (users.some(u => u.passwordHash === hash)) {
              showToast('Password is already in use. Choose a unique password.', 'error');
              return;
          }
          users.push({ username, passwordHash: hash, createdAt: new Date().toISOString() });
          saveUsers(users);
          state.currentUser = username;
          save();
          showToast('Account created! You are signed in.', 'success');
          updateHeader();
          switchPage('home-page');
          updateStats();
          renderTasks();
          renderHousingDecor();
          maybeOpenPetSelection();
      });
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) logoutBtn.addEventListener('click', () => {
          state.currentUser = null;
          save();
          switchPage('login-page');
      });
  }

  // Navigation listeners
  function initNavigation() {
      const nav = [
          ['create-task-btn', 'create-task-page'],
          ['quick-add-btn', 'quick-add-page'],
          ['view-stats-btn', 'stats-page'],
          ['view-badges-btn', 'badges-page'],
          ['view-accessories-btn', 'accessories-page'],
          ['view-minigames-btn', 'minigames-page'],
          ['back-to-home', 'home-page'],
          ['back-to-home-quick', 'home-page'],
          ['back-to-home-stats', 'home-page'],
          ['back-to-home-badges', 'home-page'],
          ['back-to-home-accessories', 'home-page'],
          ['back-to-home-minigames', 'home-page']
      ];
      nav.forEach(([id, page]) => {
          const el = document.getElementById(id);
          if (el) el.addEventListener('click', () => {
              switchPage(page);
              if (page === 'stats-page') {
                  updateStats();
                  renderCalendar();
              } else if (page === 'accessories-page') {
                  renderAccessoriesShop();
              } else if (page === 'badges-page') {
                  renderBadges();
              } else if (page === 'minigames-page') {
                  // ensure runner UI is reset
              }
          });
      });
  }

  // Filters and form handlers
  function initTasksUI() {
      document.querySelectorAll('.tasks-filters .filter-btn').forEach(btn => btn.addEventListener('click', () => {
          document.querySelectorAll('.tasks-filters .filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderTasks();
      }));
      const form = document.getElementById('task-form');
      if (form) form.addEventListener('submit', createTaskFromForm);
      const cancel = document.getElementById('cancel-task');
      if (cancel) cancel.addEventListener('click', () => switchPage('home-page'));
      const categorySelect = document.getElementById('task-category');
      if (categorySelect) categorySelect.addEventListener('change', () => {
          const customContainer = document.getElementById('custom-category-container');
          if (customContainer) customContainer.style.display = categorySelect.value === 'other' ? 'block' : 'none';
      });
      // quick add buttons might already be present on home; wire minimal handler
      const quickAddBtn = document.getElementById('quick-add-btn');
      if (quickAddBtn) quickAddBtn.addEventListener('click', () => switchPage('quick-add-page'));
  }

  // Stats UI filters
  function initStatsUI() {
      document.querySelectorAll('.stats-filters .filter-btn').forEach(btn => btn.addEventListener('click', () => {
          document.querySelectorAll('.stats-filters .filter-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          updateStats();
      }));
      const prev = document.getElementById('prev-month');
      const next = document.getElementById('next-month');
      if (prev) prev.addEventListener('click', () => { calMonth -= 1; if (calMonth < 0) { calMonth = 11; calYear -= 1; } renderCalendar(); });
      if (next) next.addEventListener('click', () => { calMonth += 1; if (calMonth > 11) { calMonth = 0; calYear += 1; } renderCalendar(); });
      const closeDayModal = document.getElementById('close-day-tasks-modal');
      if (closeDayModal) closeDayModal.addEventListener('click', () => {
          const modal = document.getElementById('day-tasks-modal');
          if (modal) modal.classList.remove('active');
      });
  }

  // Pomodoro UI events
  function initPomodoroUI() {
      const startBtn = document.getElementById('pomodoro-start');
      const pauseBtn = document.getElementById('pomodoro-pause');
      const resetBtn = document.getElementById('pomodoro-reset');
      if (startBtn) startBtn.addEventListener('click', startPomodoro);
      if (pauseBtn) pauseBtn.addEventListener('click', pausePomodoro);
      if (resetBtn) resetBtn.addEventListener('click', resetPomodoro);
      document.querySelectorAll('#pomodoro-section [data-preset]').forEach(btn => btn.addEventListener('click', () => {
          const [f, b] = btn.dataset.preset.split('-').map(n => parseInt(n, 10));
          setPomodoroPreset(f, b);
      }));
  }

  // Quick Add handlers
  function initQuickAdd() {
      document.querySelectorAll('#quick-add-page .template-btn').forEach(btn => btn.addEventListener('click', () => {
          const taskName = btn.dataset.task;
          const categoryCard = btn.closest('.category-card');
          const category = categoryCard ? (categoryCard.dataset.category || 'other') : 'other';
          let name = taskName;
          if (taskName.toLowerCase() === 'custom task') {
              const val = prompt('Enter custom task name');
              if (!val) return;
              name = val.trim();
          }
          const dueInput = document.getElementById('quick-add-due');
          let dueDate = '';
          if (dueInput && dueInput.value) {
              dueDate = dueInput.value;
          } else {
              const d = new Date();
              d.setHours(23, 59, 0, 0);
              dueDate = d.toISOString().slice(0,16);
          }
          const task = {
              id: Date.now(),
              name,
              category,
              points: 15,
              dueDate,
              completed: false
          };
          state.tasks.push(task);
          save();
          showToast('Task added', 'success');
          switchPage('home-page');
          renderTasks();
          updateStats();
      }));
  }

  // Pet UI
  function updatePetUI() {
      const avatar = document.getElementById('pet-avatar');
      const nameEl = document.getElementById('pet-name');
      const levelEl = document.getElementById('pet-level');
      const hpEl = document.getElementById('pet-health');
      const expEl = document.getElementById('pet-exp');
      const personalityBadge = document.getElementById('pet-personality');
      const personalityText = document.getElementById('pet-personality-text');
      const pet = state.pet || {};
      if (avatar) avatar.textContent = pet.avatar || '🥚';
      if (nameEl) nameEl.textContent = pet.name || 'Choose Your Pet';
      if (levelEl) levelEl.textContent = String(pet.level || 1);
      if (hpEl) { hpEl.style.width = '100%'; hpEl.textContent = '100%'; }
      if (expEl) { const pct = Math.min(100, Math.floor((pet.exp % 100))); expEl.style.width = pct + '%'; expEl.textContent = pct + '%'; }
      if (personalityBadge) personalityBadge.textContent = pet.type ? `Stage ${(pet.stage || 0) + 1}` : '';
      if (personalityText) personalityText.textContent = pet.personality || 'Unknown';
      renderAccessoryOnPet();
  }

  function maybeOpenPetSelection() {
      if (!state.pet || !state.pet.type) {
          const modal = document.getElementById('pet-selection-modal');
          if (modal) modal.classList.add('active');
      }
  }

  function initPetSelection() {
      const options = document.querySelectorAll('#pet-selection-modal .pet-option');
      let selected = null;
      options.forEach(opt => opt.addEventListener('click', () => {
          options.forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
          selected = opt.dataset.pet;
          const btn = document.getElementById('confirm-pet');
          if (btn) btn.disabled = false;
      }));
      const confirm = document.getElementById('confirm-pet');
      if (confirm) confirm.addEventListener('click', () => {
          if (!selected) return;
          const chosen = getPetBase(selected);
          state.pet = { type: selected, name: chosen.stages[0].name || chosen.name, personality: chosen.personality, avatar: chosen.stages[0].emoji, stage: 0, level: 1, exp: 0 };
          save();
          updatePetUI();
          const modal = document.getElementById('pet-selection-modal');
          if (modal) modal.classList.remove('active');
          showToast('Your companion has hatched at Level 1!', 'success');
      });
  }

  function grantPetExp(points) {
      if (!state.pet) return;
      state.pet.exp = (state.pet.exp || 0) + points;
      while (state.pet.exp >= 100) {
          state.pet.exp -= 100;
          state.pet.level = (state.pet.level || 1) + 1;
          maybeEvolvePet();
      }
      save();
      updatePetUI();
  }

  function showEvolutionModal() {
      const modal = document.getElementById('evolution-modal');
      const icon = document.getElementById('evolution-icon');
      const title = document.getElementById('evolution-title');
      const msg = document.getElementById('evolution-message');
      if (!modal || !icon || !title || !msg) return;
      icon.textContent = state.pet.avatar || '🐣';
      title.textContent = 'Evolution!';
      msg.textContent = `${state.pet.name} reached Stage ${state.pet.stage}!`;
      modal.classList.add('active');
  }

  function closeEvolutionModal() {
      const modal = document.getElementById('evolution-modal');
      if (modal) modal.classList.remove('active');
  }

  // Accessories
  const ACCESSORIES = [
      { id: 'hat-red', name: 'Red Cap', price: 20, emoji: '🧢' },
      { id: 'glasses', name: 'Glasses', price: 25, emoji: '👓' },
      { id: 'crown', name: 'Crown', price: 50, emoji: '👑' }
  ];

  function renderAccessoriesShop() {
      const grid = document.getElementById('accessories-grid');
      if (!grid) return;
      grid.innerHTML = '';
      ACCESSORIES.forEach(item => {
          const owned = state.accessoriesOwned.includes(item.id);
          const card = document.createElement('div');
          card.className = `accessory-card ${owned ? 'available' : (state.coins >= item.price ? 'available' : 'locked')}`;
          card.innerHTML = `
              <span class="accessory-icon">${item.emoji}</span>
              <div class="accessory-name">${item.name}</div>
              <div class="accessory-price">${item.price} coins</div>
              ${owned ? `<button class="accessory-btn" data-action="equip" data-id="${item.id}">${state.accessoryEquipped === item.id ? 'Equipped' : 'Equip'}</button>` : `<button class="accessory-btn" data-action="buy" data-id="${item.id}" ${state.coins < item.price ? 'disabled' : ''}>${state.coins < item.price ? 'Not enough coins' : 'Buy'}</button>`}
          `;
          grid.appendChild(card);
      });
      grid.querySelectorAll('.accessory-btn').forEach(btn => btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const action = btn.dataset.action;
          if (action === 'buy') purchaseAccessory(id);
          else if (action === 'equip') equipAccessory(id);
      }));
  }

  function purchaseAccessory(id) {
      const item = ACCESSORIES.find(i => i.id === id);
      if (!item) return;
      if (state.coins < item.price) return showToast('Not enough coins', 'error');
      if (!state.accessoriesOwned.includes(id)) state.accessoriesOwned.push(id);
      state.coins -= item.price;
      save();
      updateHeader();
      renderAccessoriesShop();
      showToast(`Purchased ${item.name}`, 'success');
  }

  function equipAccessory(id) {
      if (!state.accessoriesOwned.includes(id)) return;
      state.accessoryEquipped = id;
      save();
      renderAccessoriesShop();
      renderAccessoryOnPet();
  }

  function renderAccessoryOnPet() {
      const display = document.querySelector('.pet-display');
      if (!display) return;
      display.querySelectorAll('.pet-accessory').forEach(e => e.remove());
      if (!state.accessoryEquipped) return;
      const item = ACCESSORIES.find(i => i.id === state.accessoryEquipped);
      if (!item) return;
      const el = document.createElement('div');
      el.className = 'pet-accessory';
      el.textContent = item.emoji;
      el.style.position = 'absolute';
      el.style.top = '36px';
      el.style.left = '96px';
      el.style.fontSize = '1.5rem';
      display.appendChild(el);
  }

  // Badges
  const BADGES = [
      { id: 'first-task', icon: '🏁', name: 'First Steps', desc: 'Complete your first task', isEarned: () => state.completedTasks.length >= 1 },
      { id: 'five-tasks', icon: '🎉', name: 'On a Roll', desc: 'Complete 5 tasks', isEarned: () => state.completedTasks.length >= 5 },
      { id: 'ten-tasks', icon: '🏆', name: 'Task Master', desc: 'Complete 10 tasks', isEarned: () => state.completedTasks.length >= 10 },
      { id: 'streak-3', icon: '🔥', name: '3-Day Streak', desc: 'Complete tasks 3 days in a row', isEarned: () => state.currentStreak >= 3 },
      { id: 'streak-7', icon: '⚡', name: '7-Day Streak', desc: 'Complete tasks 7 days in a row', isEarned: () => state.currentStreak >= 7 }
  ];

  function renderBadges() {
      const grid = document.getElementById('badges-grid');
      if (!grid) return;
      grid.innerHTML = '';
      BADGES.forEach(b => {
          const earned = b.isEarned();
          const card = document.createElement('div');
          card.className = `badge-card ${earned ? 'earned' : 'locked'}`;
          card.innerHTML = `
              <div class="badge-icon">${b.icon}</div>
              <div class="badge-name">${b.name}</div>
              <div class="badge-description">${b.desc}</div>
              <div class="badge-progress">${earned ? 'Earned' : 'Locked'}</div>
          `;
          grid.appendChild(card);
      });
  }

  // Mini game: runner (dino-like)
  function initRunnerGame() {
      const playBtn = document.getElementById('start-runner-game');
      const area = document.getElementById('runner-game-area');
      const player = document.getElementById('runner-player');
      const obstacles = document.getElementById('runner-obstacles');
      const scoreEl = document.getElementById('runner-score');
      if (!playBtn || !area) return;
      let running = false;
      let yVel = 0;
      const gravity = -1.2;
      const jumpVel = 16;
      let onGround = true;
      const maxJumps = 2;
      let jumpsRemaining = maxJumps;
      let score = 0;
      let gameInterval = null;
      let spawnTimeout = null;
      const baseObstacleSpeed = 7; // px per tick baseline
      let runStartMs = 0;
      function reset() {
          yVel = 0; onGround = true; jumpsRemaining = maxJumps; score = 0; scoreEl.textContent = '0';
          player.style.bottom = '8px';
          obstacles.innerHTML = '';
      }
      function spawnObstacle() {
          const ob = document.createElement('div');
          ob.style.position = 'absolute';
          ob.style.right = '-40px';
          ob.style.bottom = '0';
          ob.style.width = '18px';
          ob.style.height = String(22 + Math.floor(Math.random()*26)) + 'px';
          ob.style.background = 'var(--warning-color)';
          ob.style.borderRadius = '3px';
          obstacles.appendChild(ob);
      }
      function scheduleSpawn(isInitial = false) {
          const elapsedSec = runStartMs ? (Date.now() - runStartMs) / 1000 : 0;
          const difficulty = Math.min(1.2, elapsedSec / 30); // ramps up over ~30s
          // Mix of tight/normal/wide gaps
          const r = Math.random();
          let gapType = 'normal';
          if (r < 0.25) gapType = 'tight';
          else if (r > 0.8) gapType = 'wide';
          // Base delays per gap type (ms), scale down over time for increased challenge
          let baseDelay = gapType === 'tight' ? 600 : gapType === 'wide' ? 1600 : 1000;
          // Reduce delay as difficulty rises, keep some variability
          let delay = baseDelay + Math.floor(Math.random() * (gapType === 'tight' ? 300 : gapType === 'wide' ? 800 : 500));
          delay = Math.max(350, Math.floor(delay * (1 - 0.35 * difficulty)));
          if (isInitial) delay = 300; // quick first obstacle
          const minGapPxByType = gapType === 'tight' ? 130 : gapType === 'wide' ? 300 : 200;
          const attempt = () => {
              // Ensure a minimum pixel gap from the last obstacle to avoid impossible stacks
              const kids = Array.from(obstacles.children);
              const last = kids[kids.length - 1];
              if (last) {
                  const lastRight = parseFloat(last.style.right || '0');
                  if (lastRight < minGapPxByType) {
                      spawnTimeout = setTimeout(attempt, 120);
                      return;
                  }
              }
              spawnObstacle();
              scheduleSpawn(false);
          };
          spawnTimeout = setTimeout(attempt, delay);
      }
      function rect(el) { return el.getBoundingClientRect(); }
      function tick() {
          // physics
          let bottom = parseFloat(player.style.bottom || '8');
          yVel += gravity;
          bottom += yVel * 0.6;
          if (bottom <= 8) { bottom = 8; yVel = 0; onGround = true; jumpsRemaining = maxJumps; }
          player.style.bottom = bottom + 'px';
          // move obstacles
          const elapsedSec = runStartMs ? (Date.now() - runStartMs) / 1000 : 0;
          const speedFactor = 1 + Math.min(1.5, elapsedSec / 25); // speed up over ~25s to +150%
          Array.from(obstacles.children).forEach(ch => {
              const right = parseFloat(ch.style.right || '0');
              ch.style.right = (right + baseObstacleSpeed * speedFactor) + 'px';
              if (parseFloat(ch.style.right) > area.clientWidth + 40) ch.remove();
          });
          // collision
          const pr = rect(player);
          Array.from(obstacles.children).forEach(ch => {
              const cr = rect(ch);
              if (!(pr.right < cr.left || pr.left > cr.right || pr.bottom < cr.top || pr.top > cr.bottom)) {
                  gameOver();
              }
          });
          // score
          score += 1;
          scoreEl.textContent = String(score);
      }
      function start() {
          if (running) return;
          running = true;
          area.style.display = 'block';
          reset();
          runStartMs = Date.now();
          gameInterval = setInterval(tick, 30);
          scheduleSpawn(true);
          const onKey = (e) => {
              if (e.code === 'Space') {
                  if (jumpsRemaining > 0) {
                      onGround = false;
                      yVel = jumpVel;
                      jumpsRemaining -= 1;
                  }
                  e.preventDefault();
              }
          };
          document.addEventListener('keydown', onKey);
          area.dataset.keyListener = 'true';
          area._onKey = onKey;
      }
      function gameOver() {
          if (!running) return;
          running = false;
          clearInterval(gameInterval);
          if (spawnTimeout) { clearTimeout(spawnTimeout); spawnTimeout = null; }
          if (area._onKey) {
              document.removeEventListener('keydown', area._onKey);
              area._onKey = null;
          }
          area.style.display = 'none';
          // rewards
          const bonusPts = Math.min(20, Math.floor(score / 50) + 5);
          state.totalPoints += bonusPts;
          state.coins += Math.min(10, Math.floor(score / 100) + 3);
          save();
          updateHeader();
          updateStats();
          showToast(`Game over! +${bonusPts} pts`, 'success');
      }
      playBtn.addEventListener('click', start);
  }

  // Boot
  document.addEventListener('DOMContentLoaded', () => {
      load();
      applyTimeOfDayTheme();
      setInterval(applyTimeOfDayTheme, 300000); // update every 5 minutes
      initAuth();
      initNavigation();
      initTasksUI();
      initStatsUI();
      initPomodoroUI();
      initRunnerGame();
      initQuickAdd();
      initPetSelection();
      updateHeader();
      renderTasks();
      updateStats();
      renderHousingDecor();
      // Initialize pomodoro remaining time
      if (!state.pomodoro.remainingSeconds) state.pomodoro.remainingSeconds = state.pomodoro.focusMinutes * 60;
      updatePomodoroUI();
      // Start on login or home depending on session
      switchPage(state.currentUser ? 'home-page' : 'login-page');
      if (state.currentUser) maybeOpenPetSelection();
      // Ensure avatar matches current level at boot
      maybeEvolvePet();
  });
  </script>
</body>
</html>

